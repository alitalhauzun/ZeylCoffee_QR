<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin Panel - Zeyl Coffee</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: #f5f6fa;
      min-height: 100vh;
    }

    .navbar {
      background: linear-gradient(135deg, #2c3e50, #34495e);
      color: white;
      padding: 15px 30px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }

    .navbar-title {
      font-size: 24px;
      font-weight: bold;
    }

    .navbar-actions {
      display: flex;
      gap: 15px;
    }

    .btn {
      padding: 10px 20px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-size: 14px;
      font-weight: 600;
      transition: all 0.3s;
    }

    .btn-primary {
      background: #3498db;
      color: white;
    }

    .btn-primary:hover {
      background: #2980b9;
    }

    .btn-success {
      background: #2ecc71;
      color: white;
    }

    .btn-success:hover {
      background: #27ae60;
    }

    .btn-danger {
      background: #e74c3c;
      color: white;
    }

    .btn-danger:hover {
      background: #c0392b;
    }

    .btn-warning {
      background: #f39c12;
      color: white;
    }

    .btn-warning:hover {
      background: #e67e22;
    }

    .btn-small {
      padding: 6px 12px;
      font-size: 12px;
    }

    .container {
      max-width: 1400px;
      margin: 30px auto;
      padding: 0 20px;
    }

    .section {
      background: white;
      padding: 25px;
      border-radius: 12px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.05);
      margin-bottom: 30px;
    }

    .section-title {
      font-size: 22px;
      font-weight: bold;
      margin-bottom: 20px;
      color: #2c3e50;
      border-bottom: 3px solid #3498db;
      padding-bottom: 10px;
    }

    .weekly-specials {
      display: grid;
      gap: 15px;
    }

    .weekly-item {
      display: grid;
      grid-template-columns: 2fr 1fr 3fr auto auto;
      gap: 15px;
      padding: 15px;
      background: #f8f9fa;
      border-radius: 8px;
      align-items: center;
    }

    .category-section {
      margin-bottom: 40px;
    }

    .category-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 15px 20px;
      background: linear-gradient(135deg, #3498db, #2980b9);
      color: white;
      border-radius: 10px;
      margin-bottom: 15px;
    }

    .category-name {
      font-size: 20px;
      font-weight: bold;
    }

    .menu-table {
      width: 100%;
      border-collapse: collapse;
      background: white;
      border-radius: 8px;
      overflow: hidden;
      box-shadow: 0 2px 8px rgba(0,0,0,0.05);
    }

    .menu-table th {
      background: #34495e;
      color: white;
      padding: 12px;
      text-align: left;
      font-weight: 600;
    }

    .menu-table td {
      padding: 12px;
      border-bottom: 1px solid #ecf0f1;
    }

    .menu-table tr:hover {
      background: #f8f9fa;
    }

    input[type="text"],
    input[type="number"],
    textarea {
      width: 100%;
      padding: 8px 12px;
      border: 2px solid #ddd;
      border-radius: 6px;
      font-size: 14px;
      transition: all 0.3s;
    }

    input[type="text"]:focus,
    input[type="number"]:focus,
    textarea:focus {
      border-color: #3498db;
      outline: none;
    }

    textarea {
      min-height: 60px;
      resize: vertical;
    }

    .switch {
      position: relative;
      display: inline-block;
      width: 50px;
      height: 24px;
    }

    .switch input {
      opacity: 0;
      width: 0;
      height: 0;
    }

    .slider {
      position: absolute;
      cursor: pointer;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: #ccc;
      transition: .4s;
      border-radius: 24px;
    }

    .slider:before {
      position: absolute;
      content: "";
      height: 16px;
      width: 16px;
      left: 4px;
      bottom: 4px;
      background-color: white;
      transition: .4s;
      border-radius: 50%;
    }

    input:checked + .slider {
      background-color: #2ecc71;
    }

    input:checked + .slider:before {
      transform: translateX(26px);
    }

    .modal {
      display: none;
      position: fixed;
      z-index: 1000;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0,0,0,0.5);
    }

    .modal-content {
      background-color: white;
      margin: 5% auto;
      padding: 30px;
      border-radius: 12px;
      width: 90%;
      max-width: 500px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.3);
    }

    .modal-header {
      font-size: 22px;
      font-weight: bold;
      margin-bottom: 20px;
      color: #2c3e50;
    }

    .form-group {
      margin-bottom: 20px;
    }

    .form-group label {
      display: block;
      margin-bottom: 8px;
      font-weight: 600;
      color: #34495e;
    }

    .close {
      color: #aaa;
      float: right;
      font-size: 28px;
      font-weight: bold;
      cursor: pointer;
    }

    .close:hover {
      color: #000;
    }

    @media (max-width: 768px) {
      .weekly-item {
        grid-template-columns: 1fr;
      }

      .menu-table {
        font-size: 12px;
      }

      .btn {
        padding: 8px 15px;
        font-size: 12px;
      }
    }
  </style>
</head>
<body>
  <div class="navbar">
    <div class="navbar-title">ğŸ‰ Zeyl Coffee Admin Panel</div>
    <div class="navbar-actions">
      <button class="btn btn-warning" onclick="openPasswordModal()">ğŸ”‘ Åifre DeÄŸiÅŸtir</button>
      <button class="btn btn-danger" onclick="location.href='/admin/logout'">ğŸšª Ã‡Ä±kÄ±ÅŸ</button>
    </div>
  </div>

  <div class="container">
    <!-- Ä°statistikler Section -->
    <div class="section">
      <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; flex-wrap: wrap; gap: 10px;">
        <div class="section-title" style="margin: 0;">ğŸ“Š Kategori TÄ±klama Ä°statistikleri</div>
        <div style="display: flex; gap: 10px;">
          <button class="btn btn-success" onclick="exportStatistics()">ğŸ“¥ Excel'e Aktar</button>
          <button class="btn btn-danger" onclick="resetStatistics()">ğŸ”„ Ä°statistikleri SÄ±fÄ±rla</button>
        </div>
      </div>

      <div id="statisticsContainer" style="margin-top: 20px;">
        <p style="text-align: center; color: #7f8c8d;">YÃ¼kleniyor...</p>
      </div>
    </div>

    <!-- HaftanÄ±n ÃœrÃ¼nleri Section -->
    <div class="section">
      <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
        <div class="section-title" style="margin: 0;">â­ HaftanÄ±n ÃœrÃ¼nleri</div>
        <button class="btn btn-success" onclick="openWeeklyModal()">â• Yeni ÃœrÃ¼n Ekle</button>
      </div>

      <% if (weeklySpecials.length === 0) { %>
        <p style="color: #7f8c8d; text-align: center; padding: 20px;">HenÃ¼z haftanÄ±n Ã¼rÃ¼nÃ¼ eklenmemiÅŸ.</p>
      <% } else { %>
        <div class="weekly-specials">
          <% weeklySpecials.forEach(special => { %>
            <div class="weekly-item">
              <% if (special.image) { %>
                <div style="text-align: center; margin-bottom: 10px;">
                  <img src="/<%= special.image %>" alt="<%= special.name %>" style="max-width: 150px; max-height: 150px; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                </div>
              <% } %>
              <input type="text" value="<%= special.name %>" onchange="updateWeeklySpecial(<%= special.id %>, 'name', this.value)">
              <input type="number" step="0.01" placeholder="Fiyat (â‚º)" value="<%= special.price || '' %>" onchange="updateWeeklySpecial(<%= special.id %>, 'price', this.value)">
              <textarea placeholder="AÃ§Ä±klama" onchange="updateWeeklySpecial(<%= special.id %>, 'description', this.value)"><%= special.description || '' %></textarea>
              <div style="display: flex; gap: 5px; flex-wrap: wrap;">
                <button class="btn btn-primary btn-small" onclick="openWeeklyImageUpload(<%= special.id %>)">ğŸ“· Resim</button>
                <% if (special.image) { %>
                  <button class="btn btn-warning btn-small" onclick="deleteWeeklyImage(<%= special.id %>)">ğŸ—‘ï¸ Resim Sil</button>
                <% } %>
                <button class="btn btn-success btn-small" onclick="updateWeeklySpecial(<%= special.id %>)">ğŸ’¾ Kaydet</button>
                <button class="btn btn-danger btn-small" onclick="deleteWeeklySpecial(<%= special.id %>)">ğŸ—‘ï¸ ÃœrÃ¼nÃ¼ Sil</button>
              </div>
            </div>
          <% }); %>
        </div>
      <% } %>
    </div>


    <!-- Kampanyalar Section -->
    <div class="section">
      <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
        <div class="section-title" style="margin: 0;">ğŸ”¥ Kampanyalar</div>
        <button class="btn btn-success" onclick="openCampaignModal()">â• Yeni Kampanya Ekle</button>
      </div>

      <% if (campaigns.length === 0) { %>
        <p style="color: #7f8c8d; text-align: center; padding: 20px;">HenÃ¼z kampanya eklenmemiÅŸ.</p>
      <% } else { %>
        <div class="weekly-specials">
          <% campaigns.forEach(campaign => { %>
            <div class="weekly-item">
              <% if (campaign.image) { %>
                <div style="text-align: center; margin-bottom: 10px;">
                  <img src="/<%= campaign.image %>" alt="<%= campaign.name %>" style="max-width: 150px; max-height: 150px; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                </div>
              <% } %>
              <input type="text" value="<%= campaign.name %>" onchange="updateCampaign(<%= campaign.id %>, 'name', this.value)">
              <input type="number" step="0.01" placeholder="Eski Fiyat (â‚º)" value="<%= campaign.old_price || '' %>" onchange="updateCampaign(<%= campaign.id %>, 'old_price', this.value)">
              <input type="number" step="0.01" placeholder="Yeni Fiyat (â‚º)" value="<%= campaign.new_price || '' %>" onchange="updateCampaign(<%= campaign.id %>, 'new_price', this.value)">
              <textarea placeholder="AÃ§Ä±klama" onchange="updateCampaign(<%= campaign.id %>, 'description', this.value)"><%= campaign.description || '' %></textarea>
              <div style="display: flex; gap: 5px; flex-wrap: wrap;">
                <button class="btn btn-primary btn-small" onclick="openCampaignImageUpload(<%= campaign.id %>)">ğŸ“· Resim</button>
                <% if (campaign.image) { %>
                  <button class="btn btn-warning btn-small" onclick="deleteCampaignImage(<%= campaign.id %>)">ğŸ—‘ï¸ Resim Sil</button>
                <% } %>
                <button class="btn btn-success btn-small" onclick="updateCampaign(<%= campaign.id %>)">ğŸ’¾ Kaydet</button>
                <button class="btn btn-danger btn-small" onclick="deleteCampaign(<%= campaign.id %>)">ğŸ—‘ï¸ KampanyayÄ± Sil</button>
              </div>
            </div>
          <% }); %>
        </div>
      <% } %>
    </div>


    <!-- Instagram FotoÄŸraflarÄ± Section -->
    <div class="section">
      <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
        <div class="section-title" style="margin: 0;">ğŸ“¸ Instagram FotoÄŸraflarÄ±</div>
        <button class="btn btn-success" onclick="openInstagramModal()">â• Yeni FotoÄŸraf KartÄ±</button>
      </div>

      <% if (!instagramPosts || instagramPosts.length === 0) { %>
        <p style="color: #7f8c8d; text-align: center; padding: 20px;">HenÃ¼z Instagram fotoÄŸrafÄ± eklenmemiÅŸ.</p>
      <% } else { %>
        <div class="weekly-specials">
          <% instagramPosts.forEach(post => { %>
            <div class="weekly-item">
              <% if (post.image) { %>
                <div style="text-align: center; margin-bottom: 10px;">
                  <img src="/<%= post.image %>" alt="Instagram FotoÄŸrafÄ±" style="max-width: 100%; max-height: 180px; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                </div>
              <% } %>
              <textarea placeholder="AÃ§Ä±klama" onchange="updateInstagramPost(<%= post.id %>, this.value)"><%= post.caption || '' %></textarea>
              <div style="display: flex; gap: 5px; flex-wrap: wrap; margin-top: 8px;">
                <button class="btn btn-primary btn-small" onclick="openInstagramImageUpload(<%= post.id %>)">ğŸ“· Resim</button>
                <% if (post.image) { %>
                  <button class="btn btn-warning btn-small" onclick="deleteInstagramImage(<%= post.id %>)">ğŸ—‘ï¸ Resim Sil</button>
                <% } %>
                <button class="btn btn-danger btn-small" onclick="deleteInstagramPost(<%= post.id %>)">ğŸ—‘ï¸ KartÄ± Sil</button>
              </div>
            </div>
          <% }); %>
        </div>
      <% } %>
    </div>

<!-- Kategoriler ve MenÃ¼ Section -->
    <div class="section">
      <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
        <div class="section-title" style="margin: 0;">ğŸ“‹ MenÃ¼ Kategorileri</div>
        <button class="btn btn-success" onclick="openCategoryModal()">â• Yeni Kategori</button>
      </div>

      <% menuData.forEach((data, index) => { %>
        <div class="category-section">
          <div class="category-header">
            <span class="category-name"><%= data.category.name %></span>
            <div style="display: flex; gap: 10px;">
              <% if (index > 0) { %>
              <button class="btn btn-primary btn-small" onclick="reorderCategory(<%= data.category.id %>, 'up')">â†‘</button>
              <% } %>
              <% if (index < menuData.length - 1) { %>
              <button class="btn btn-primary btn-small" onclick="reorderCategory(<%= data.category.id %>, 'down')">â†“</button>
              <% } %>
              <button class="btn btn-warning btn-small" onclick="openAddItemModal(<%= data.category.id %>)">â• Yeni ÃœrÃ¼n Ekle</button>
              <button class="btn btn-danger btn-small" onclick="deleteCategory(<%= data.category.id %>)">ğŸ—‘ï¸ Kategoriyi Sil</button>
            </div>
          </div>

          <table class="menu-table">
            <thead>
              <tr>
                <th style="width: 8%;">Resim</th>
                <th style="width: 25%;">ÃœrÃ¼n AdÄ±</th>
                <th style="width: 12%;">Fiyat (â‚º)</th>
                <th style="width: 25%;">AÃ§Ä±klama</th>
                <th style="width: 8%;">Durum</th>
                <th style="width: 22%;">Ä°ÅŸlemler</th>
              </tr>
            </thead>
            <tbody>
              <% if (data.items.length === 0) { %>
                <tr>
                  <td colspan="6" style="text-align: center; color: #7f8c8d;">Bu kategoride Ã¼rÃ¼n bulunmuyor.</td>
                </tr>
              <% } else { %>
                <% data.items.forEach(item => { %>
                  <tr id="item-<%= item.id %>">
                    <td style="text-align: center;">
                      <% if (item.image) { %>
                        <img src="/<%= item.image %>" style="width: 60px; height: 60px; object-fit: cover; border-radius: 8px; display: block; margin: 0 auto;">
                      <% } else { %>
                        <div style="width: 60px; height: 60px; background: #f0f0f0; border-radius: 8px; display: flex; align-items: center; justify-content: center; margin: 0 auto; color: #999; font-size: 20px;">ğŸ“·</div>
                      <% } %>
                    </td>
                    <td>
                      <input type="text" value="<%= item.name %>" 
                             onblur="updateItem(<%= item.id %>, 'name', this.value)">
                    </td>
                    <td>
                      <input type="number" step="0.01" value="<%= item.price || '' %>" 
                             id="price-<%= item.id %>" 
                             placeholder="Fiyat">
                    </td>
                    <td>
                      <textarea onblur="updateItem(<%= item.id %>, 'description', this.value)" 
                                placeholder="ÃœrÃ¼n aÃ§Ä±klamasÄ±"><%= item.description || '' %></textarea>
                    </td>
                    <td>
                      <label class="switch">
                        <input type="checkbox" <%= item.is_available ? 'checked' : '' %>
                               onchange="updateItem(<%= item.id %>, 'is_available', this.checked)">
                        <span class="slider"></span>
                      </label>
                    </td>
                    <td>
                      <div style="display: flex; gap: 5px; flex-wrap: wrap;">
                        <button class="btn btn-primary btn-small" onclick="openImageUpload(<%= item.id %>)">ğŸ“· Resim</button>
                        <% if (item.image) { %>
                          <button class="btn btn-warning btn-small" onclick="deleteItemImage(<%= item.id %>)">ğŸ—‘ï¸ Resim Sil</button>
                        <% } %>
                        <button class="btn btn-success btn-small" onclick="saveItemPrice(<%= item.id %>)">ğŸ’¾ Fiyat Kaydet</button>
                        <button class="btn btn-danger btn-small" onclick="deleteItem(<%= item.id %>)">ğŸ—‘ï¸ Sil</button>
                      </div>
                    </td>
                  </tr>
                <% }); %>
              <% } %>
            </tbody>
          </table>
        </div>
      <% }); %>
    </div>
  </div>

  <!-- Yeni Kategori Modal -->
  <div id="categoryModal" class="modal">
    <div class="modal-content">
      <span class="close" onclick="closeCategoryModal()">&times;</span>
      <div class="modal-header">â• Yeni Kategori Ekle</div>
      <div class="form-group">
        <label>Kategori AdÄ±</label>
        <input type="text" id="categoryName" placeholder="Ã–rn: TatlÄ±lar">
      </div>
      <button class="btn btn-success" style="width: 100%;" onclick="addCategory()">Kategori Ekle</button>
    </div>
  </div>

  <!-- Yeni ÃœrÃ¼n Modal -->
  <div id="itemModal" class="modal">
    <div class="modal-content">
      <span class="close" onclick="closeItemModal()">&times;</span>
      <div class="modal-header">â• Yeni ÃœrÃ¼n Ekle</div>
      <input type="hidden" id="itemCategoryId">
      <div class="form-group">
        <label>ÃœrÃ¼n AdÄ±</label>
        <input type="text" id="itemName" placeholder="Ã–rn: TÃ¼rk Kahvesi">
      </div>
      <div class="form-group">
        <label>Fiyat (â‚º) - Ä°steÄŸe BaÄŸlÄ±</label>
        <input type="number" step="0.01" id="itemPrice" placeholder="Ã–rn: 65">
      </div>
      <div class="form-group">
        <label>AÃ§Ä±klama - Ä°steÄŸe BaÄŸlÄ±</label>
        <textarea id="itemDescription" placeholder="ÃœrÃ¼n hakkÄ±nda kÄ±sa aÃ§Ä±klama"></textarea>
      </div>
      <button class="btn btn-success" style="width: 100%;" onclick="addItem()">ÃœrÃ¼n Ekle</button>
    </div>
  </div>


  <!-- Instagram FotoÄŸraf KartÄ± Modal -->
  <div id="instagramModal" class="modal">
    <div class="modal-content">
      <span class="close" onclick="closeInstagramModal()">&times;</span>
      <div class="modal-header">ğŸ“¸ Yeni Instagram FotoÄŸraf KartÄ±</div>
      <div class="form-group">
        <label>AÃ§Ä±klama (Ä°steÄŸe BaÄŸlÄ±)</label>
        <textarea id="instagramCaption" placeholder="Ã–rn: Zengin kahvaltÄ±mÄ±zla gÃ¼ne baÅŸlayÄ±n."></textarea>
      </div>
      <button class="btn btn-success" style="width: 100%;" onclick="addInstagramPost()">Kart Ekle</button>
    </div>
  </div>

  <!-- Instagram FotoÄŸrafÄ± Resim YÃ¼kleme Modal -->
  <div id="instagramImageModal" class="modal">
    <div class="modal-content">
      <span class="close" onclick="closeInstagramImageModal()">&times;</span>
      <div class="modal-header">ğŸ“· Instagram FotoÄŸrafÄ± YÃ¼kle</div>
      <input type="hidden" id="instagramImagePostId">
      <div class="form-group">
        <label>Resim SeÃ§ (Max 5MB - jpg, jpeg, png, gif, webp)</label>
        <input type="file" id="instagramImageFile" accept="image/*" style="padding: 10px; border: 2px dashed #3498db; border-radius: 8px; background: #f8f9fa;">
      </div>
      <div id="instagramImagePreview" style="margin: 15px 0; text-align: center; display: none;">
        <img id="instagramPreviewImg" style="max-width: 100%; max-height: 300px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
      </div>
      <button class="btn btn-success" style="width: 100%;" onclick="uploadInstagramImage()">ğŸ“¤ Resmi YÃ¼kle</button>
    </div>
  </div>

<!-- HaftanÄ±n ÃœrÃ¼nÃ¼ Modal -->
  <div id="weeklyModal" class="modal">
    <div class="modal-content">
      <span class="close" onclick="closeWeeklyModal()">&times;</span>
      <div class="modal-header">â­ HaftanÄ±n ÃœrÃ¼nÃ¼ Ekle</div>
      <div class="form-group">
        <label>ÃœrÃ¼n AdÄ±</label>
        <input type="text" id="weeklyName" placeholder="Ã–rn: Ã–zel Cheesecake">
      </div>
      <div class="form-group">
        <label>Fiyat (â‚º) - Ä°steÄŸe BaÄŸlÄ±</label>
        <input type="number" step="0.01" id="weeklyPrice" placeholder="Ã–rn: 85">
      </div>
      <div class="form-group">
        <label>AÃ§Ä±klama - Ä°steÄŸe BaÄŸlÄ±</label>
        <textarea id="weeklyDescription" placeholder="Bu haftaya Ã¶zel..."></textarea>
      </div>
      <button class="btn btn-success" style="width: 100%;" onclick="addWeeklySpecial()">ÃœrÃ¼n Ekle</button>
    </div>
  </div>

  <!-- Kampanya Ekle Modal -->
  <div id="campaignModal" class="modal">
    <div class="modal-content">
      <span class="close" onclick="closeCampaignModal()">&times;</span>
      <div class="modal-header">ğŸ”¥ Kampanya Ekle</div>
      <div class="form-group">
        <label>Kampanya AdÄ±</label>
        <input type="text" id="campaignName" placeholder="Ã–rn: Ã–ÄŸrenci MenÃ¼sÃ¼">
      </div>
      <div class="form-group">
        <label>Eski Fiyat (â‚º) - Ä°steÄŸe BaÄŸlÄ±</label>
        <input type="number" step="0.01" id="campaignOldPrice" placeholder="Ã–rn: 100">
      </div>
      <div class="form-group">
        <label>Yeni Fiyat (â‚º) - Ä°steÄŸe BaÄŸlÄ±</label>
        <input type="number" step="0.01" id="campaignNewPrice" placeholder="Ã–rn: 75">
      </div>
      <div class="form-group">
        <label>AÃ§Ä±klama - Ä°steÄŸe BaÄŸlÄ±</label>
        <textarea id="campaignDescription" placeholder="Kampanya detaylarÄ±..."></textarea>
      </div>
      <button class="btn btn-success" style="width: 100%;" onclick="addCampaign()">Kampanya Ekle</button>
    </div>
  </div>

  <!-- Kampanya Resim YÃ¼kleme Modal -->
  <div id="campaignImageModal" class="modal">
    <div class="modal-content">
      <span class="close" onclick="closeCampaignImageModal()">&times;</span>
      <div class="modal-header">ğŸ“· Kampanya Resmi YÃ¼kle</div>
      <input type="hidden" id="campaignImageCampaignId">
      <div class="form-group">
        <label>Resim SeÃ§</label>
        <input type="file" id="campaignImageFile" accept="image/*">
      </div>
      <div id="campaignImagePreview" style="display: none; text-align: center; margin: 15px 0;">
        <img id="campaignPreviewImg" style="max-width: 100%; max-height: 300px; border-radius: 8px;">
      </div>
      <button class="btn btn-success" style="width: 100%;" onclick="uploadCampaignImage()">Resmi YÃ¼kle</button>
    </div>
  </div>

  <!-- Åifre DeÄŸiÅŸtir Modal -->
  <div id="passwordModal" class="modal">
    <div class="modal-content">
      <span class="close" onclick="closePasswordModal()">&times;</span>
      <div class="modal-header">ğŸ”‘ Åifre DeÄŸiÅŸtir</div>
      <div class="form-group">
        <label>Mevcut Åifre</label>
        <input type="password" id="currentPassword">
      </div>
      <div class="form-group">
        <label>Yeni Åifre</label>
        <input type="password" id="newPassword">
      </div>
      <button class="btn btn-success" style="width: 100%;" onclick="changePassword()">Åifreyi DeÄŸiÅŸtir</button>
    </div>
  </div>

  <!-- Resim YÃ¼kleme Modal -->
  <div id="imageModal" class="modal">
    <div class="modal-content">
      <span class="close" onclick="closeImageModal()">&times;</span>
      <div class="modal-header">ğŸ“· ÃœrÃ¼n Resmi YÃ¼kle</div>
      <input type="hidden" id="imageItemId">
      <div class="form-group">
        <label>Resim SeÃ§ (Max 5MB - jpg, jpeg, png, gif, webp)</label>
        <input type="file" id="imageFile" accept="image/*" style="width: 100%; padding: 10px; border: 2px dashed #3498db; border-radius: 8px; background: #f8f9fa;">
      </div>
      <div id="imagePreview" style="margin: 15px 0; text-align: center; display: none;">
        <img id="previewImg" style="max-width: 100%; max-height: 200px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
      </div>
      <button class="btn btn-success" style="width: 100%;" onclick="uploadImage()">ğŸ“¤ Resmi YÃ¼kle</button>
    </div>
  </div>

  <!-- HaftanÄ±n ÃœrÃ¼nÃ¼ Resim YÃ¼kleme Modal -->
  <div id="weeklyImageModal" class="modal">
    <div class="modal-content">
      <span class="close" onclick="closeWeeklyImageModal()">&times;</span>
      <div class="modal-header">ğŸ“· HaftanÄ±n ÃœrÃ¼nÃ¼ Resmi YÃ¼kle</div>
      <input type="hidden" id="weeklyImageSpecialId">
      <div class="form-group">
        <label>Resim SeÃ§ (Max 5MB - jpg, jpeg, png, gif, webp)</label>
        <input type="file" id="weeklyImageFile" accept="image/*" style="width: 100%; padding: 10px; border: 2px dashed #3498db; border-radius: 8px; background: #f8f9fa;">
      </div>
      <div id="weeklyImagePreview" style="margin: 15px 0; text-align: center; display: none;">
        <img id="weeklyPreviewImg" style="max-width: 100%; max-height: 200px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
      </div>
      <button class="btn btn-success" style="width: 100%;" onclick="uploadWeeklyImage()">ğŸ“¤ Resmi YÃ¼kle</button>
    </div>
  </div>

  <script>
    function updateItem(itemId, field, value) {
      const data = { id: itemId };
      data[field] = value;

      fetch('/admin/update-item', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(data)
      })
      .then(res => res.json())
      .then(data => {
        if (data.success) {
          console.log('GÃ¼ncellendi');
        }
      });
    }


    function saveItemPrice(itemId) {
      const input = document.getElementById('price-' + itemId);
      if (!input) return;

      const value = input.value;

      if (value === '' || value === null) {
        alert('LÃ¼tfen geÃ§erli bir fiyat girin.');
        return;
      }

      updateItem(itemId, 'price', value);
    }

    function deleteItem(itemId) {
      if (!confirm('Bu Ã¼rÃ¼nÃ¼ silmek istediÄŸinizden emin misiniz?')) return;

      fetch('/admin/delete-item', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ id: itemId })
      })
      .then(res => res.json())
      .then(data => {
        if (data.success) {
          location.reload();
        }
      });
    }

    function openAddItemModal(categoryId) {
      document.getElementById('itemCategoryId').value = categoryId;
      document.getElementById('itemModal').style.display = 'block';
    }

    function closeItemModal() {
      document.getElementById('itemModal').style.display = 'none';
      document.getElementById('itemName').value = '';
      document.getElementById('itemPrice').value = '';
      document.getElementById('itemDescription').value = '';
    }

    function addItem() {
      const categoryId = document.getElementById('itemCategoryId').value;
      const name = document.getElementById('itemName').value;
      const price = document.getElementById('itemPrice').value;
      const description = document.getElementById('itemDescription').value;

      if (!name) {
        alert('ÃœrÃ¼n adÄ± gerekli!');
        return;
      }

      fetch('/admin/add-item', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ category_id: categoryId, name, price, description })
      })
      .then(res => res.json())
      .then(data => {
        if (data.success) {
          closeItemModal();
          location.reload();
        }
      });
    }

    function openCategoryModal() {
      document.getElementById('categoryModal').style.display = 'block';
    }

    function closeCategoryModal() {
      document.getElementById('categoryModal').style.display = 'none';
      document.getElementById('categoryName').value = '';
    }

    function addCategory() {
      const name = document.getElementById('categoryName').value.trim();

      if (!name) {
        alert('Kategori adÄ± gerekli!');
        return;
      }

      fetch('/admin/add-category', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ name })
      })
      .then(res => res.json())
      .then(data => {
        if (data.success) {
          alert('Kategori baÅŸarÄ±yla eklendi!');
          closeCategoryModal();
          location.reload();
        } else {
          alert('Kategori eklenemedi: ' + (data.error || 'Bilinmeyen hata'));
        }
      })
      .catch(err => {
        console.error('Hata:', err);
        alert('Bir hata oluÅŸtu: ' + err.message);
      });
    }

    function deleteCategory(categoryId) {
      if (!confirm('Bu kategoriyi ve iÃ§indeki TÃœM Ã¼rÃ¼nleri silmek istediÄŸinizden emin misiniz?')) return;

      fetch('/admin/delete-category', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ id: categoryId })
      })
      .then(res => res.json())
      .then(data => {
        if (data.success) {
          location.reload();
        }
      });
    }

    function openWeeklyModal() {
      document.getElementById('weeklyModal').style.display = 'block';
    }

    function closeWeeklyModal() {
      document.getElementById('weeklyModal').style.display = 'none';
      document.getElementById('weeklyName').value = '';
      document.getElementById('weeklyPrice').value = '';
      document.getElementById('weeklyDescription').value = '';
    }

    function addWeeklySpecial() {
      const name = document.getElementById('weeklyName').value;
      const price = document.getElementById('weeklyPrice').value;
      const description = document.getElementById('weeklyDescription').value;

      if (!name) {
        alert('ÃœrÃ¼n adÄ± gerekli!');
        return;
      }

      fetch('/admin/add-weekly-special', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ name, price, description })
      })
      .then(res => res.json())
      .then(data => {
        if (data.success) {
          closeWeeklyModal();
          location.reload();
        }
      });
    }

    function updateWeeklySpecial(specialId, field, value) {
      const data = { id: specialId };
      if (field) {
        data[field] = value;
      }

      fetch('/admin/update-weekly-special', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(data)
      })
      .then(res => res.json())
      .then(data => {
        if (data.success) {
          console.log('GÃ¼ncellendi');
        }
      });
    }

    function deleteWeeklySpecial(specialId) {
      if (!confirm('Bu Ã¼rÃ¼nÃ¼ silmek istediÄŸinizden emin misiniz?')) return;

      fetch('/admin/delete-weekly-special', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ id: specialId })
      })
      .then(res => res.json())
      .then(data => {
        if (data.success) {
          location.reload();
        }
      });
    }

    // ============= KAMPANYA FONKSÄ°YONLARI =============

    function openCampaignModal() {
      document.getElementById('campaignModal').style.display = 'block';
    }

    function closeCampaignModal() {
      document.getElementById('campaignModal').style.display = 'none';
      document.getElementById('campaignName').value = '';
      document.getElementById('campaignOldPrice').value = '';
      document.getElementById('campaignNewPrice').value = '';
      document.getElementById('campaignDescription').value = '';
    }

    function addCampaign() {
      const name = document.getElementById('campaignName').value;
      const old_price = document.getElementById('campaignOldPrice').value;
      const new_price = document.getElementById('campaignNewPrice').value;
      const description = document.getElementById('campaignDescription').value;

      if (!name) {
        alert('Kampanya adÄ± gerekli!');
        return;
      }

      fetch('/admin/add-campaign', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ name, old_price, new_price, description })
      })
      .then(res => res.json())
      .then(data => {
        if (data.success) {
          closeCampaignModal();
          location.reload();
        }
      });
    }

    function updateCampaign(campaignId, field, value) {
      const data = { id: campaignId };
      if (field) {
        data[field] = value;
      }

      fetch('/admin/update-campaign', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(data)
      })
      .then(res => res.json())
      .then(data => {
        if (data.success && !field) {
          location.reload();
        }
      });
    }

    function deleteCampaign(campaignId) {
      if (!confirm('Bu kampanyayÄ± silmek istediÄŸinizden emin misiniz?')) return;

      fetch('/admin/delete-campaign', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ id: campaignId })
      })
      .then(res => res.json())
      .then(data => {
        if (data.success) {
          location.reload();
        }
      });
    }

    function openCampaignImageUpload(campaignId) {
      document.getElementById('campaignImageCampaignId').value = campaignId;
      document.getElementById('campaignImageFile').value = '';
      document.getElementById('campaignImagePreview').style.display = 'none';
      document.getElementById('campaignImageModal').style.display = 'block';
    }

    function closeCampaignImageModal() {
      document.getElementById('campaignImageModal').style.display = 'none';
    }

    // Kampanya resim Ã¶nizleme
    document.addEventListener('DOMContentLoaded', function() {
      const campaignImageFile = document.getElementById('campaignImageFile');
      if (campaignImageFile) {
        campaignImageFile.addEventListener('change', function(e) {
          const file = e.target.files[0];
          if (file) {
            const reader = new FileReader();
            reader.onload = function(e) {
              document.getElementById('campaignPreviewImg').src = e.target.result;
              document.getElementById('campaignImagePreview').style.display = 'block';
            }
            reader.readAsDataURL(file);
          }
        });
      }
    });

    function uploadCampaignImage() {
      const campaignId = document.getElementById('campaignImageCampaignId').value;
      const fileInput = document.getElementById('campaignImageFile');
      const file = fileInput.files[0];

      if (!file) {
        alert('LÃ¼tfen bir resim seÃ§in!');
        return;
      }

      const formData = new FormData();
      formData.append('image', file);
      formData.append('campaignId', campaignId);

      fetch('/admin/upload-campaign-image', {
        method: 'POST',
        body: formData
      })
      .then(res => res.json())
      .then(data => {
        if (data.success) {
          alert('âœ… Resim baÅŸarÄ±yla yÃ¼klendi!');
          closeCampaignImageModal();
          location.reload();
        } else {
          alert(data.error || 'Resim yÃ¼klenemedi!');
        }
      })
      .catch(err => {
        console.error('Hata:', err);
        alert('Bir hata oluÅŸtu!');
      });
    }

    function deleteCampaignImage(campaignId) {
      if (!confirm('Kampanya resmini silmek istediÄŸinizden emin misiniz?')) return;

      fetch('/admin/delete-campaign-image', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ campaignId })
      })
      .then(res => res.json())
      .then(data => {
        if (data.success) {
          alert('âœ… Resim silindi!');
          location.reload();
        } else {
          alert(data.error || 'Resim silinemedi!');
        }
      })
      .catch(err => {
        console.error('Hata:', err);
        alert('Bir hata oluÅŸtu!');
      });
    }

    function openPasswordModal() {
      document.getElementById('passwordModal').style.display = 'block';
    }

    function closePasswordModal() {
      document.getElementById('passwordModal').style.display = 'none';
      document.getElementById('currentPassword').value = '';
      document.getElementById('newPassword').value = '';
    }

    function changePassword() {
      const currentPassword = document.getElementById('currentPassword').value;
      const newPassword = document.getElementById('newPassword').value;

      if (!currentPassword || !newPassword) {
        alert('TÃ¼m alanlarÄ± doldurun!');
        return;
      }

      fetch('/admin/change-password', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ currentPassword, newPassword })
      })
      .then(res => res.json())
      .then(data => {
        if (data.success) {
          alert('Åifre baÅŸarÄ±yla deÄŸiÅŸtirildi!');
          closePasswordModal();
        } else {
          alert(data.error || 'Åifre deÄŸiÅŸtirilemedi!');
        }
      });
    }

    function reorderCategory(categoryId, direction) {
      fetch('/admin/reorder-categories', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ categoryId, direction })
      })
      .then(res => res.json())
      .then(data => {
        if (data.success) {
          location.reload();
        } else {
          alert(data.error || 'SÄ±ralama gÃ¼ncellenemedi!');
        }
      })
      .catch(err => {
        console.error('Hata:', err);
        alert('Bir hata oluÅŸtu!');
      });
    }

    function openImageUpload(itemId) {
      document.getElementById('imageItemId').value = itemId;
      document.getElementById('imageFile').value = '';
      document.getElementById('imagePreview').style.display = 'none';
      document.getElementById('imageModal').style.display = 'block';
    }

    function closeImageModal() {
      document.getElementById('imageModal').style.display = 'none';
    }

    // Resim Ã¶nizleme
    document.getElementById('imageFile').addEventListener('change', function(e) {
      const file = e.target.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = function(e) {
          document.getElementById('previewImg').src = e.target.result;
          document.getElementById('imagePreview').style.display = 'block';
        }
        reader.readAsDataURL(file);
      }
    });

    function uploadImage() {
      const itemId = document.getElementById('imageItemId').value;
      const fileInput = document.getElementById('imageFile');
      const file = fileInput.files[0];

      if (!file) {
        alert('LÃ¼tfen bir resim seÃ§in!');
        return;
      }

      const formData = new FormData();
      formData.append('image', file);
      formData.append('itemId', itemId);

      fetch('/admin/upload-image', {
        method: 'POST',
        body: formData
      })
      .then(res => res.json())
      .then(data => {
        if (data.success) {
          alert('Resim baÅŸarÄ±yla yÃ¼klendi!');
          closeImageModal();
          location.reload();
        } else {
          alert(data.error || 'Resim yÃ¼klenemedi!');
        }
      })
      .catch(err => {
        console.error('Hata:', err);
        alert('Bir hata oluÅŸtu!');
      });
    }

    function deleteItemImage(itemId) {
      if (!confirm('ÃœrÃ¼n resmini silmek istediÄŸinizden emin misiniz?')) return;

      fetch('/admin/delete-image', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ itemId })
      })
      .then(res => res.json())
      .then(data => {
        if (data.success) {
          location.reload();
        } else {
          alert(data.error || 'Resim silinemedi!');
        }
      })
      .catch(err => {
        console.error('Hata:', err);
        alert('Bir hata oluÅŸtu!');
      });
    }

    // HaftanÄ±n Ã¼rÃ¼nÃ¼ iÃ§in resim yÃ¼kleme modal'Ä± aÃ§
    function openWeeklyImageUpload(specialId) {
      document.getElementById('weeklyImageSpecialId').value = specialId;
      document.getElementById('weeklyImageFile').value = '';
      document.getElementById('weeklyImagePreview').style.display = 'none';
      document.getElementById('weeklyImageModal').style.display = 'block';
    }

    function closeWeeklyImageModal() {
      document.getElementById('weeklyImageModal').style.display = 'none';
    }

    // HaftanÄ±n Ã¼rÃ¼nÃ¼ resim Ã¶nizleme
    document.addEventListener('DOMContentLoaded', function() {
      const weeklyImageFile = document.getElementById('weeklyImageFile');
      if (weeklyImageFile) {
        weeklyImageFile.addEventListener('change', function(e) {
          const file = e.target.files[0];
          if (file) {
            const reader = new FileReader();
            reader.onload = function(e) {
              document.getElementById('weeklyPreviewImg').src = e.target.result;
              document.getElementById('weeklyImagePreview').style.display = 'block';
            }
            reader.readAsDataURL(file);
          }
        });
      }
    });

    function uploadWeeklyImage() {
      const specialId = document.getElementById('weeklyImageSpecialId').value;
      const fileInput = document.getElementById('weeklyImageFile');
      const file = fileInput.files[0];

      if (!file) {
        alert('LÃ¼tfen bir resim seÃ§in!');
        return;
      }

      const formData = new FormData();
      formData.append('image', file);
      formData.append('specialId', specialId);

      fetch('/admin/upload-weekly-image', {
        method: 'POST',
        body: formData
      })
      .then(res => res.json())
      .then(data => {
        if (data.success) {
          alert('âœ… Resim baÅŸarÄ±yla yÃ¼klendi!');
          closeWeeklyImageModal();
          location.reload();
        } else {
          alert(data.error || 'Resim yÃ¼klenemedi!');
        }
      })
      .catch(err => {
        console.error('Hata:', err);
        alert('Bir hata oluÅŸtu!');
      });
    }

    function deleteWeeklyImage(specialId) {
      if (!confirm('ÃœrÃ¼n resmini silmek istediÄŸinizden emin misiniz?')) return;

      fetch('/admin/delete-weekly-image', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ specialId })
      })
      .then(res => res.json())
      .then(data => {
        if (data.success) {
          alert('âœ… Resim silindi!');
          location.reload();
        } else {
          alert(data.error || 'Resim silinemedi!');
        }
      })
      .catch(err => {
        console.error('Hata:', err);
        alert('Bir hata oluÅŸtu!');
      });
    }

    // Modal dÄ±ÅŸÄ±na tÄ±klanÄ±nca kapat
    window.onclick = function(event) {
      if (event.target.classList.contains('modal')) {
        event.target.style.display = 'none';
      }
    }

    // Ä°statistikleri yÃ¼kle
    function loadStatistics() {
      fetch('/admin/statistics')
        .then(res => {
          if (!res.ok) {
            throw new Error(`HTTP ${res.status}: ${res.statusText}`);
          }
          return res.json();
        })
        .then(stats => {
          const container = document.getElementById('statisticsContainer');

          if (!stats || !stats.categoryClicks || Object.keys(stats.categoryClicks).length === 0) {
            container.innerHTML = '<p style="text-align: center; color: #7f8c8d;">HenÃ¼z istatistik bulunmuyor. MenÃ¼de bir kategoriye tÄ±klandÄ±ÄŸÄ±nda burada gÃ¶rÃ¼necek.</p>';
            return;
          }

          // Toplam tÄ±klamalar
          const totalClicks = Object.values(stats.categoryClicks).reduce((sum, cat) => sum + cat.totalClicks, 0);

          // Kategorileri tÄ±klama sayÄ±sÄ±na gÃ¶re sÄ±rala
          const sortedCategories = Object.entries(stats.categoryClicks)
            .sort((a, b) => b[1].totalClicks - a[1].totalClicks);

          let html = `
            <div style="background: #ecf0f1; padding: 15px; border-radius: 8px; margin-bottom: 20px; text-align: center;">
              <h3 style="margin: 0; color: #2c3e50;">Toplam TÄ±klama: <span style="color: #3498db;">${totalClicks}</span></h3>
            </div>
            <table class="menu-table">
              <thead>
                <tr>
                  <th>SÄ±ra</th>
                  <th>Kategori AdÄ±</th>
                  <th>Toplam TÄ±klama</th>
                  <th>Son TÄ±klama</th>
                </tr>
              </thead>
              <tbody>
          `;

          sortedCategories.forEach(([categoryId, data], index) => {
            const lastClicked = data.lastClicked 
              ? new Date(data.lastClicked).toLocaleString('tr-TR')
              : 'HiÃ§ tÄ±klanmadÄ±';

            html += `
              <tr>
                <td style="text-align: center; font-weight: bold;">${index + 1}</td>
                <td>${data.name}</td>
                <td style="text-align: center; color: #3498db; font-weight: bold;">${data.totalClicks}</td>
                <td style="font-size: 12px; color: #7f8c8d;">${lastClicked}</td>
              </tr>
            `;
          });

          html += '</tbody></table>';

          // BugÃ¼nÃ¼n istatistikleri
          const today = new Date().toISOString().split('T')[0];
          if (stats.dailyClicks && stats.dailyClicks[today]) {
            const todayClicks = Object.values(stats.dailyClicks[today]).reduce((sum, cat) => sum + cat.clicks, 0);
            html += `
              <div style="background: #e8f5e9; padding: 15px; border-radius: 8px; margin-top: 20px; text-align: center;">
                <h3 style="margin: 0; color: #2c3e50;">BugÃ¼n: <span style="color: #27ae60;">${todayClicks} tÄ±klama</span></h3>
              </div>
            `;
          }

          container.innerHTML = html;
        })
        .catch(err => {
          console.error('Ä°statistik yÃ¼klenemedi:', err);
          document.getElementById('statisticsContainer').innerHTML = 
            `<p style="text-align: center; color: #e74c3c;">
              Ä°statistikler yÃ¼klenirken hata oluÅŸtu: ${err.message}<br>
              <small>Console'u (F12) kontrol edin veya sayfayÄ± yenileyin.</small>
            </p>`;
        });
    }

    // Ä°statistikleri sÄ±fÄ±rla
    function resetStatistics() {
      if (!confirm('TÃ¼m istatistikleri sÄ±fÄ±rlamak istediÄŸinizden emin misiniz?\n\nBu iÅŸlem geri alÄ±namaz!')) {
        return;
      }

      fetch('/admin/reset-statistics', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' }
      })
      .then(res => res.json())
      .then(data => {
        if (data.success) {
          alert('âœ… Ä°statistikler baÅŸarÄ±yla sÄ±fÄ±rlandÄ±!');
          loadStatistics(); // Ä°statistikleri yeniden yÃ¼kle
        } else {
          alert('âŒ Ä°statistikler sÄ±fÄ±rlanÄ±rken hata oluÅŸtu!');
        }
      })
      .catch(err => {
        console.error('Hata:', err);
        alert('âŒ Bir hata oluÅŸtu: ' + err.message);
      });
    }


    // Instagram fotoÄŸraf kartlarÄ±
    function openInstagramModal() {
      const modal = document.getElementById('instagramModal');
      if (modal) {
        modal.style.display = 'block';
      }
    }

    function closeInstagramModal() {
      const modal = document.getElementById('instagramModal');
      if (modal) {
        modal.style.display = 'none';
      }
      const captionEl = document.getElementById('instagramCaption');
      if (captionEl) {
        captionEl.value = '';
      }
    }

    function addInstagramPost() {
      const captionEl = document.getElementById('instagramCaption');
      const caption = captionEl ? captionEl.value.trim() : '';

      fetch('/admin/add-instagram-post', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ caption })
      })
      .then(res => res.json())
      .then(data => {
        if (data.success) {
          closeInstagramModal();
          location.reload();
        } else {
          alert(data.error || 'Instagram kartÄ± eklenemedi!');
        }
      })
      .catch(err => {
        console.error('Hata:', err);
        alert('Bir hata oluÅŸtu!');
      });
    }

    function updateInstagramPost(postId, caption) {
      fetch('/admin/update-instagram-post', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ id: postId, caption: caption })
      })
      .then(res => res.json())
      .then(data => {
        if (!data.success) {
          alert(data.error || 'Instagram kartÄ± gÃ¼ncellenemedi!');
        }
      })
      .catch(err => {
        console.error('Hata:', err);
        alert('Bir hata oluÅŸtu!');
      });
    }

    function deleteInstagramPost(postId) {
      if (!confirm('Bu Instagram kartÄ±nÄ± silmek istediÄŸinizden emin misiniz?')) return;

      fetch('/admin/delete-instagram-post', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ id: postId })
      })
      .then(res => res.json())
      .then(data => {
        if (data.success) {
          location.reload();
        } else {
          alert(data.error || 'Kart silinemedi!');
        }
      })
      .catch(err => {
        console.error('Hata:', err);
        alert('Bir hata oluÅŸtu!');
      });
    }

    function openInstagramImageUpload(postId) {
      const modal = document.getElementById('instagramImageModal');
      const idInput = document.getElementById('instagramImagePostId');
      const fileInput = document.getElementById('instagramImageFile');
      const preview = document.getElementById('instagramImagePreview');
      const img = document.getElementById('instagramPreviewImg');

      if (idInput) idInput.value = postId;
      if (fileInput) fileInput.value = '';
      if (preview) preview.style.display = 'none';
      if (img) img.src = '';

      if (modal) {
        modal.style.display = 'block';
      }
    }

    function closeInstagramImageModal() {
      const modal = document.getElementById('instagramImageModal');
      const fileInput = document.getElementById('instagramImageFile');
      const preview = document.getElementById('instagramImagePreview');
      const img = document.getElementById('instagramPreviewImg');

      if (fileInput) fileInput.value = '';
      if (preview) preview.style.display = 'none';
      if (img) img.src = '';
      if (modal) {
        modal.style.display = 'none';
      }
    }

    function uploadInstagramImage() {
      const postIdEl = document.getElementById('instagramImagePostId');
      const fileInput = document.getElementById('instagramImageFile');

      if (!postIdEl) {
        alert('GeÃ§ersiz Instagram kartÄ±.');
        return;
      }
      if (!fileInput || !fileInput.files || fileInput.files.length === 0) {
        alert('LÃ¼tfen yÃ¼klenecek bir resim seÃ§in.');
        return;
      }

      const formData = new FormData();
      formData.append('postId', postIdEl.value);
      formData.append('image', fileInput.files[0]);

      fetch('/admin/upload-instagram-image', {
        method: 'POST',
        body: formData
      })
      .then(res => res.json())
      .then(data => {
        if (data.success) {
          closeInstagramImageModal();
          location.reload();
        } else {
          alert(data.error || 'Resim yÃ¼klenemedi!');
        }
      })
      .catch(err => {
        console.error('Hata:', err);
        alert('Bir hata oluÅŸtu!');
      });
    }

    function deleteInstagramImage(postId) {
      if (!confirm('Bu fotoÄŸrafÄ±n resmini silmek istediÄŸinizden emin misiniz?')) return;

      fetch('/admin/delete-instagram-image', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ id: postId })
      })
      .then(res => res.json())
      .then(data => {
        if (data.success) {
          location.reload();
        } else {
          alert(data.error || 'Resim silinemedi!');
        }
      })
      .catch(err => {
        console.error('Hata:', err);
        alert('Bir hata oluÅŸtu!');
      });
    }

// Excel'e aktar
    function exportStatistics() {
      // Yeni sekmede Excel dosyasÄ±nÄ± indir
      window.open('/admin/export-statistics', '_blank');
    }

    // Sayfa yÃ¼klendiÄŸinde istatistikleri yÃ¼kle
    document.addEventListener('DOMContentLoaded', function() {
      loadStatistics();
    });
  </script>
</body>
</html>
